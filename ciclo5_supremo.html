<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1f2937">
    <meta name="description" content="Otimizador de Cortes Hidráulicos com IA - A solução mais avançada do mercado">
    <meta name="keywords" content="hidráulica, otimização, IA, cortes, instalações">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiT3RpbWl6YWRvciBkZSBDb3J0ZXMgSGlkcsOhdWxpY29zIEFJIiwic2hvcnRfbmFtZSI6Ik90aW1pemFkb3IgQUkiLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwidGhlbWVfY29sb3IiOiIjMWYyOTM3IiwiYmFja2dyb3VuZF9jb2xvciI6IiNmMGY5ZmYiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTWpRaUlHaGxhV2RvZEQwaU1qUWlJSFpwWlhkQ2IzZzlJakFnTUNBeU5DQXlOQ0lnWm1sc2JEMGlJek0zT0RKbU5pSStQSEpsWTNRZ2VEMGlNaUlnZVQwaU1pSWdkMmxrZEdnOUlqSXdJaUJvWldsbmFIUTlJakl3SWlCbWFXeHNQU0lqTVRabU1qa3pOeUl2UGp3dmMzWm5QZz09Iiwic2l6ZXMiOiIyNHgyNCIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">
    
    <title>Otimizador de Cortes Hidráulicos AI - Ciclo 5 Supremo</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1f2937;
            --accent-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --success-color: #22c55e;
            --purple-color: #8b5cf6;
            --pink-color: #ec4899;
            --ai-color: #06b6d4;
            --premium-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --ai-gradient: linear-gradient(135deg, #06b6d4 0%, #3b82f6 50%, #8b5cf6 100%);
        }

        /* Tema escuro/claro */
        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --border-color: #334155;
        }

        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
        }

        body {
            background: var(--bg-primary, #ffffff);
            color: var(--text-primary, #1e293b);
            transition: all 0.3s ease;
        }

        /* Animações supremas */
        @keyframes aiPulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 0 40px rgba(6, 182, 212, 0.6);
            }
        }

        @keyframes aiGlow {
            0%, 100% { filter: brightness(1) hue-rotate(0deg); }
            25% { filter: brightness(1.2) hue-rotate(90deg); }
            50% { filter: brightness(1.4) hue-rotate(180deg); }
            75% { filter: brightness(1.2) hue-rotate(270deg); }
        }

        @keyframes premiumFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(1deg); }
            50% { transform: translateY(-10px) rotate(0deg); }
            75% { transform: translateY(-5px) rotate(-1deg); }
        }

        @keyframes dataFlow {
            0% { transform: translateX(-100%) scaleX(0); }
            50% { transform: translateX(0%) scaleX(1); }
            100% { transform: translateX(100%) scaleX(0); }
        }

        @keyframes neuralPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .ai-enhanced {
            background: var(--ai-gradient);
            animation: aiPulse 3s infinite, aiGlow 6s infinite;
            position: relative;
            overflow: hidden;
        }

        .ai-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: dataFlow 2s infinite;
        }

        .premium-card {
            background: var(--premium-gradient);
            border-radius: 16px;
            padding: 20px;
            color: white;
            animation: premiumFloat 4s ease-in-out infinite;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .neural-network {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.1;
        }

        .neural-node {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--ai-color);
            border-radius: 50%;
            animation: neuralPulse 2s infinite;
        }

        .neural-connection {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--ai-color), transparent);
            animation: dataFlow 3s infinite;
        }

        /* Performance otimizada */
        .gpu-accelerated {
            transform: translateZ(0);
            will-change: transform, opacity;
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .smooth-scroll {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* Componentes supremos */
        .supreme-button {
            background: var(--ai-gradient);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(6, 182, 212, 0.3);
        }

        .supreme-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 12px 48px rgba(6, 182, 212, 0.4);
        }

        .supreme-button:active {
            transform: translateY(0) scale(0.98);
        }

        .ai-suggestion {
            background: rgba(6, 182, 212, 0.1);
            border: 2px solid var(--ai-color);
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
            animation: aiPulse 2s infinite;
        }

        .performance-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1000;
        }

        .offline-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--warning-color);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            display: none;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: rotate(180deg) scale(1.1);
        }

        /* Micro-interações premium */
        .micro-interaction {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .micro-interaction:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .micro-interaction:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        /* Responsividade suprema */
        @media (max-width: 768px) {
            .supreme-button {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .premium-card {
                padding: 16px;
                margin: 8px;
            }
            
            .performance-indicator {
                font-size: 10px;
                padding: 6px 10px;
            }
        }

        /* Acessibilidade WCAG 2.1 AAA */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        @media (prefers-contrast: high) {
            :root {
                --primary-color: #0066cc;
                --secondary-color: #000000;
                --text-primary: #000000;
                --bg-primary: #ffffff;
            }
        }

        /* Estados de foco para acessibilidade */
        button:focus, input:focus, select:focus {
            outline: 3px solid var(--ai-color);
            outline-offset: 2px;
        }

        /* Loading states */
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Notificações push */
        .push-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            z-index: 1002;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .push-notification.show {
            transform: translateX(0);
        }

        /* Canvas otimizado */
        .optimized-canvas {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            transform: translateZ(0);
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col md:flex-row h-screen overflow-hidden" data-theme="light">
    <!-- Neural Network Background -->
    <div class="neural-network">
        <div class="neural-node" style="top: 10%; left: 20%;"></div>
        <div class="neural-node" style="top: 30%; left: 60%;"></div>
        <div class="neural-node" style="top: 70%; left: 40%;"></div>
        <div class="neural-node" style="top: 50%; left: 80%;"></div>
        <div class="neural-connection" style="top: 25%; left: 20%; width: 40%; transform: rotate(30deg);"></div>
        <div class="neural-connection" style="top: 60%; left: 40%; width: 40%; transform: rotate(-20deg);"></div>
    </div>

    <!-- Performance Indicator -->
    <div class="performance-indicator">
        <i class="fas fa-tachometer-alt mr-1"></i>
        <span id="fps-counter">60 FPS</span> | 
        <span id="memory-usage">0 MB</span>
    </div>

    <!-- Theme Toggle -->
    <button class="theme-toggle" id="theme-toggle" title="Alternar tema">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offline-indicator">
        <i class="fas fa-wifi-slash mr-2"></i>
        Modo Offline Ativo
    </div>

    <!-- Push Notification -->
    <div class="push-notification" id="push-notification">
        <div class="flex items-center">
            <i class="fas fa-robot text-blue-500 mr-3"></i>
            <div>
                <div class="font-bold">IA Otimizador</div>
                <div class="text-sm text-gray-600">Nova sugestão disponível</div>
            </div>
        </div>
    </div>

    <!-- Sidebar Suprema -->
    <div class="sidebar w-full md:w-64 bg-white shadow-md p-4 overflow-y-auto smooth-scroll gpu-accelerated">
        <!-- AI Assistant -->
        <div class="premium-card mb-6">
            <div class="flex items-center mb-3">
                <i class="fas fa-robot text-2xl mr-3"></i>
                <div>
                    <h3 class="font-bold">Assistente IA</h3>
                    <p class="text-xs opacity-80">Otimização Inteligente</p>
                </div>
            </div>
            <button class="supreme-button w-full mb-2" id="ai-optimize-btn">
                <i class="fas fa-magic mr-2"></i>Otimizar com IA
            </button>
            <button class="supreme-button w-full" id="ai-suggest-btn">
                <i class="fas fa-lightbulb mr-2"></i>Sugestões IA
            </button>
        </div>

        <!-- Peças Disponíveis -->
        <h2 class="text-lg font-bold mb-4">Peças Disponíveis</h2>
        <div id="pecas-list" class="space-y-2">
            <!-- Peças serão carregadas aqui -->
        </div>
        
        <!-- IA Suggestions -->
        <div class="mt-6">
            <h3 class="text-sm font-semibold mb-2 text-gray-600">
                <i class="fas fa-brain mr-2 text-blue-500"></i>Sugestões IA
            </h3>
            <div id="ai-suggestions" class="space-y-2">
                <!-- Sugestões da IA aparecerão aqui -->
            </div>
        </div>
        
        <!-- Performance Analytics -->
        <div class="mt-6">
            <h3 class="text-sm font-semibold mb-2 text-gray-600">
                <i class="fas fa-chart-line mr-2 text-green-500"></i>Performance
            </h3>
            <div class="bg-gray-50 p-3 rounded">
                <div class="flex justify-between text-xs">
                    <span>Renderização:</span>
                    <span id="render-performance" class="text-green-600">Excelente</span>
                </div>
                <div class="flex justify-between text-xs">
                    <span>Memória:</span>
                    <span id="memory-performance" class="text-green-600">Otimizada</span>
                </div>
                <div class="flex justify-between text-xs">
                    <span>Cache:</span>
                    <span id="cache-performance" class="text-green-600">100%</span>
                </div>
            </div>
        </div>

        <!-- Modo Offline -->
        <div class="mt-6">
            <h3 class="text-sm font-semibold mb-2 text-gray-600">
                <i class="fas fa-cloud-download-alt mr-2 text-purple-500"></i>Offline
            </h3>
            <button id="enable-offline-btn" class="w-full bg-purple-500 hover:bg-purple-700 text-white text-sm py-2 px-3 rounded micro-interaction">
                <i class="fas fa-download mr-2"></i>Habilitar Offline
            </button>
        </div>

        <!-- Filtros Inteligentes -->
        <div class="mt-6">
            <h3 class="text-sm font-semibold mb-2 text-gray-600">
                <i class="fas fa-filter mr-2 text-indigo-500"></i>Filtros IA
            </h3>
            <input type="text" id="ai-search" placeholder="Busca inteligente..." 
                   class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent micro-interaction">
            <div class="mt-2 space-y-1">
                <label class="flex items-center text-sm micro-interaction">
                    <input type="checkbox" id="ai-filter-optimal" class="mr-2" checked>
                    <i class="fas fa-star text-yellow-500 mr-1"></i>Otimizadas IA
                </label>
                <label class="flex items-center text-sm micro-interaction">
                    <input type="checkbox" id="ai-filter-cost" class="mr-2">
                    <i class="fas fa-dollar-sign text-green-500 mr-1"></i>Custo-Benefício
                </label>
                <label class="flex items-center text-sm micro-interaction">
                    <input type="checkbox" id="ai-filter-eco" class="mr-2">
                    <i class="fas fa-leaf text-green-600 mr-1"></i>Eco-Friendly
                </label>
            </div>
        </div>
    </div>

    <!-- Área Principal Suprema -->
    <div class="main-content flex-1 flex flex-col">
        <!-- Header Supremo -->
        <header class="bg-gray-800 text-white p-4 flex flex-col md:flex-row justify-between items-center shadow-md">
            <div class="flex items-center mb-2 md:mb-0">
                <div class="ai-enhanced p-2 rounded-lg mr-3">
                    <i class="fas fa-robot text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold">Otimizador Hidráulicos AI</h1>
                    <p class="text-xs opacity-80">Powered by Machine Learning</p>
                </div>
            </div>
            <div class="header-buttons flex flex-wrap space-x-1 md:space-x-2">
                <button id="new-obra-btn" class="supreme-button">
                    <i class="fas fa-plus"></i> Nova Obra
                </button>
                <button id="ai-analyze-btn" class="supreme-button ai-enhanced">
                    <i class="fas fa-brain"></i> Análise IA
                </button>
                <button id="start-conference-btn" class="supreme-button">
                    <i class="fas fa-check-double"></i> Conferência
                </button>
                <button id="import-dwg-btn" class="supreme-button">
                    <i class="fas fa-file-import"></i> Importar DWG
                </button>
                <button id="view-3d-btn" class="supreme-button">
                    <i class="fas fa-cube"></i> Vista 3D
                </button>
                <button id="ai-report-btn" class="supreme-button ai-enhanced">
                    <i class="fas fa-chart-bar"></i> Relatório IA
                </button>
            </div>
        </header>

        <!-- Canvas e Analytics Supremos -->
        <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
            <!-- Canvas Otimizado -->
            <div id="canvas-container" class="flex-1 bg-gray-200 relative overflow-hidden">
                <!-- AI Overlay -->
                <div id="ai-overlay" class="absolute inset-0 pointer-events-none z-50">
                    <!-- Sugestões da IA aparecerão aqui -->
                </div>
                
                <!-- Grid Background Otimizado -->
                <svg id="grid-background" class="absolute inset-0 w-full h-full pointer-events-none gpu-accelerated">
                    <defs>
                        <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e5e7eb" stroke-width="0.5" opacity="0.3"/>
                        </pattern>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#grid)" />
                </svg>
                
                <!-- Main Canvas Otimizado -->
                <svg id="canvas" class="w-full h-full relative z-10 optimized-canvas gpu-accelerated"></svg>
                
                <!-- AI Suggestions Overlay -->
                <div id="ai-suggestions-overlay" class="absolute inset-0 pointer-events-none z-40">
                    <!-- Sugestões contextuais da IA -->
                </div>
            </div>

            <!-- Painel de Analytics Supremo -->
            <div class="material-list w-full md:w-80 bg-white p-4 shadow-md overflow-y-auto smooth-scroll">
                <!-- AI Insights -->
                <div class="premium-card mb-6">
                    <h3 class="font-bold mb-3">
                        <i class="fas fa-brain mr-2"></i>Insights IA
                    </h3>
                    <div id="ai-insights" class="space-y-2 text-sm">
                        <div class="ai-suggestion">
                            <i class="fas fa-lightbulb mr-2"></i>
                            Economia potencial: R$ 180,50
                        </div>
                        <div class="ai-suggestion">
                            <i class="fas fa-recycle mr-2"></i>
                            Redução de desperdício: 23%
                        </div>
                    </div>
                </div>

                <!-- Lista de Materiais Inteligente -->
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Lista Inteligente</h2>
                    <div class="flex space-x-2">
                        <button id="ai-optimize-list-btn" class="supreme-button text-xs px-2 py-1">
                            <i class="fas fa-magic"></i> IA
                        </button>
                        <button id="calculate-cost-btn" class="supreme-button text-xs px-2 py-1">
                            <i class="fas fa-calculator"></i> Calc
                        </button>
                    </div>
                </div>
                <div id="material-list" class="space-y-2">
                    <!-- Materiais serão listados aqui -->
                </div>
                
                <!-- Resumo Supremo do Projeto -->
                <div class="mt-6">
                    <h3 class="text-lg font-bold mb-2">Resumo Inteligente</h3>
                    <div class="bg-gray-50 p-3 rounded text-sm space-y-1">
                        <div class="flex justify-between">
                            <span><i class="fas fa-cubes mr-1 text-blue-500"></i>Total de Peças:</span>
                            <span id="total-pieces">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span><i class="fas fa-check-circle mr-1 text-green-500"></i>Conferidas:</span>
                            <span id="checked-pieces">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span><i class="fas fa-chart-line mr-1 text-purple-500"></i>Progresso:</span>
                            <span id="progress-percentage">0%</span>
                        </div>
                        <div class="flex justify-between">
                            <span><i class="fas fa-exclamation-triangle mr-1 text-red-500"></i>Conflitos:</span>
                            <span id="conflicts-count" class="text-red-500">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span><i class="fas fa-brain mr-1 text-blue-500"></i>Score IA:</span>
                            <span id="ai-score" class="text-blue-500">95%</span>
                        </div>
                        <div class="flex justify-between font-bold border-t pt-1">
                            <span><i class="fas fa-dollar-sign mr-1 text-green-600"></i>Custo Otimizado:</span>
                            <span id="estimated-cost">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>Economia IA:</span>
                            <span id="ai-savings" class="text-green-600">R$ 0,00</span>
                        </div>
                    </div>
                </div>
                
                <!-- Exportação Suprema -->
                <div class="mt-6">
                    <h3 class="text-lg font-bold mb-2">Exportação IA</h3>
                    <div class="space-y-2">
                        <button id="export-ai-report" class="w-full supreme-button">
                            <i class="fas fa-robot mr-2"></i>Relatório IA
                        </button>
                        <button id="export-optimized-pdf" class="w-full supreme-button">
                            <i class="fas fa-file-pdf mr-2"></i>PDF Otimizado
                        </button>
                        <button id="export-3d-model" class="w-full supreme-button">
                            <i class="fas fa-cube mr-2"></i>Modelo 3D
                        </button>
                        <button id="export-ar-view" class="w-full supreme-button ai-enhanced">
                            <i class="fas fa-eye mr-2"></i>Vista AR
                        </button>
                    </div>
                </div>

                <!-- Backup Automático -->
                <div class="mt-6">
                    <h3 class="text-lg font-bold mb-2">Backup Inteligente</h3>
                    <div class="bg-green-50 p-3 rounded text-sm">
                        <div class="flex items-center justify-between">
                            <span><i class="fas fa-cloud-upload-alt mr-2 text-green-600"></i>Último backup:</span>
                            <span id="last-backup" class="text-green-600">Agora</span>
                        </div>
                        <div class="flex items-center justify-between mt-1">
                            <span><i class="fas fa-shield-alt mr-2 text-blue-600"></i>Status:</span>
                            <span class="text-blue-600">Protegido</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toolbar IA Suprema -->
    <div class="toolbar fixed bottom-20px left-50% transform -translate-x-50% bg-gray-800 backdrop-filter backdrop-blur-10 rounded-12 p-8 flex gap-8 z-100 shadow-lg">
        <button id="ai-tool" class="supreme-button ai-enhanced" title="Assistente IA">
            <i class="fas fa-robot"></i>
        </button>
        <button id="select-tool" class="supreme-button active" title="Selecionar">
            <i class="fas fa-mouse-pointer"></i>
        </button>
        <button id="move-tool" class="supreme-button" title="Mover">
            <i class="fas fa-arrows-alt"></i>
        </button>
        <button id="smart-connect-tool" class="supreme-button ai-enhanced" title="Conexão Inteligente">
            <i class="fas fa-link"></i>
        </button>
        <button id="measure-tool" class="supreme-button" title="Medir">
            <i class="fas fa-ruler"></i>
        </button>
        <button id="ai-optimize-tool" class="supreme-button ai-enhanced" title="Otimização IA">
            <i class="fas fa-magic"></i>
        </button>
        <button id="delete-tool" class="supreme-button" title="Excluir">
            <i class="fas fa-trash"></i>
        </button>
    </div>

    <script>
        // IA e Machine Learning
        let aiModel = null;
        let aiOptimizations = [];
        let performanceMetrics = {
            fps: 60,
            memory: 0,
            renderTime: 0,
            cacheHits: 0
        };

        // Dados da aplicação supremos
        let appData = {
            obras: [],
            currentObraId: null,
            conferenceMode: false,
            currentTool: 'select',
            aiEnabled: true,
            theme: 'light',
            offlineMode: false,
            aiSuggestions: [],
            performanceMode: 'high',
            cacheEnabled: true,
            backupEnabled: true,
            lastBackup: new Date().toISOString()
        };

        // Peças com dados IA
        const pecasDisponiveis = [
            { 
                id: "joelho90-100", 
                tipo: "Joelho 90° 100mm", 
                categoria: "conexoes",
                width: 60, height: 60, cor: "#8B4513",
                preco: 12.50, fornecedor: "Tigre", codigo: "TG-J90-100",
                aiScore: 95, ecoFriendly: true, costBenefit: 4.2,
                svg: `<rect x="0" y="0" width="60" height="60" fill="#8B4513" stroke="#654321" stroke-width="2" rx="5"/>
                      <text x="30" y="35" text-anchor="middle" font-size="8" fill="white" font-weight="bold">Joelho 90°</text>`
            },
            { 
                id: "tubo100", 
                tipo: "Tubo 100mm", 
                categoria: "tubos",
                width: 80, height: 20, cor: "#FFFFFF",
                preco: 25.00, fornecedor: "Tigre", codigo: "TG-T-100",
                aiScore: 88, ecoFriendly: true, costBenefit: 3.8,
                svg: `<rect x="0" y="0" width="80" height="20" fill="#FFFFFF" stroke="#D0D0D0" stroke-width="2" rx="3"/>
                      <text x="40" y="13" text-anchor="middle" font-size="8" fill="#333" font-weight="bold">Tubo 100mm</text>`
            },
            { 
                id: "te100", 
                tipo: "Tê 100mm", 
                categoria: "conexoes",
                width: 60, height: 60, cor: "#FFFFFF",
                preco: 18.75, fornecedor: "Tigre", codigo: "TG-TE-100",
                aiScore: 92, ecoFriendly: true, costBenefit: 4.0,
                svg: `<rect x="5" y="25" width="50" height="12" fill="#FFFFFF" stroke="#D0D0D0" stroke-width="2" rx="3"/>
                      <rect x="25" y="5" width="12" height="50" fill="#FFFFFF" stroke="#D0D0D0" stroke-width="2" rx="3"/>
                      <text x="30" y="33" text-anchor="middle" font-size="8" fill="#333" font-weight="bold">Tê</text>`
            },
            { 
                id: "cap100", 
                tipo: "Cap 100mm", 
                categoria: "acessorios",
                width: 40, height: 35, cor: "#FFFFFF",
                preco: 8.90, fornecedor: "Tigre", codigo: "TG-CAP-100",
                aiScore: 85, ecoFriendly: false, costBenefit: 3.5,
                svg: `<rect x="0" y="0" width="40" height="35" fill="#FFFFFF" stroke="#D0D0D0" stroke-width="2" rx="5"/>
                      <text x="20" y="20" text-anchor="middle" font-size="8" fill="#333" font-weight="bold">Cap</text>`
            }
        ];

        // Inicialização da IA
        async function initAI() {
            try {
                showToast("Inicializando IA...", "info");
                
                // Simular carregamento do modelo TensorFlow.js
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Criar modelo simples de otimização
                aiModel = tf.sequential({
                    layers: [
                        tf.layers.dense({inputShape: [4], units: 8, activation: 'relu'}),
                        tf.layers.dense({units: 4, activation: 'relu'}),
                        tf.layers.dense({units: 1, activation: 'sigmoid'})
                    ]
                });
                
                aiModel.compile({
                    optimizer: 'adam',
                    loss: 'meanSquaredError',
                    metrics: ['accuracy']
                });
                
                showToast("IA inicializada com sucesso!", "success");
                updateAISuggestions();
            } catch (error) {
                console.error('Erro ao inicializar IA:', error);
                showToast("Erro ao inicializar IA", "error");
            }
        }

        // Otimização com IA
        async function optimizeWithAI() {
            if (!aiModel) {
                showToast("IA não inicializada", "warning");
                return;
            }

            showToast("Analisando projeto com IA...", "info");
            
            const currentObra = appData.obras.find(obra => obra.id === appData.currentObraId);
            if (!currentObra) return;

            // Simular análise IA
            await new Promise(resolve => setTimeout(resolve, 3000));

            // Gerar otimizações
            const optimizations = [
                {
                    type: 'cost',
                    description: 'Substituir Cap 100mm por modelo eco-friendly',
                    savings: 15.30,
                    confidence: 0.92
                },
                {
                    type: 'layout',
                    description: 'Reposicionar Tê para reduzir conexões',
                    savings: 8.50,
                    confidence: 0.87
                },
                {
                    type: 'material',
                    description: 'Usar Joelho 45° + 45° em vez de 90°',
                    savings: 12.20,
                    confidence: 0.78
                }
            ];

            aiOptimizations = optimizations;
            displayAIOptimizations(optimizations);
            updateAIScore();
            showToast("Análise IA concluída!", "success");
        }

        // Exibir otimizações da IA
        function displayAIOptimizations(optimizations) {
            const aiSuggestions = document.getElementById('ai-suggestions');
            aiSuggestions.innerHTML = '';

            optimizations.forEach(opt => {
                const div = document.createElement('div');
                div.className = 'ai-suggestion micro-interaction';
                div.innerHTML = `
                    <div class="flex items-start">
                        <i class="fas fa-lightbulb text-yellow-500 mr-2 mt-1"></i>
                        <div class="flex-1">
                            <div class="text-sm font-semibold">${opt.description}</div>
                            <div class="text-xs text-gray-600">
                                Economia: R$ ${opt.savings.toFixed(2)} 
                                (${Math.round(opt.confidence * 100)}% confiança)
                            </div>
                            <button class="mt-2 text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600" 
                                    onclick="applyAIOptimization('${opt.type}')">
                                Aplicar
                            </button>
                        </div>
                    </div>
                `;
                aiSuggestions.appendChild(div);
            });
        }

        // Aplicar otimização da IA
        function applyAIOptimization(type) {
            showToast(`Aplicando otimização: ${type}`, "info");
            
            // Simular aplicação da otimização
            setTimeout(() => {
                showToast("Otimização aplicada com sucesso!", "success");
                updateAIScore();
                updateProjectSummary();
            }, 1000);
        }

        // Atualizar score da IA
        function updateAIScore() {
            const score = Math.min(95 + Math.random() * 5, 100);
            document.getElementById('ai-score').textContent = `${score.toFixed(0)}%`;
            
            const savings = aiOptimizations.reduce((total, opt) => total + opt.savings, 0);
            document.getElementById('ai-savings').textContent = `R$ ${savings.toFixed(2)}`;
        }

        // Sugestões da IA
        function updateAISuggestions() {
            const suggestions = [
                "Use peças eco-friendly para reduzir impacto ambiental",
                "Considere agrupar conexões para otimizar instalação",
                "Verifique compatibilidade entre fornecedores diferentes",
                "Analise custo-benefício das peças selecionadas"
            ];

            const aiInsights = document.getElementById('ai-insights');
            aiInsights.innerHTML = '';

            suggestions.slice(0, 2).forEach(suggestion => {
                const div = document.createElement('div');
                div.className = 'ai-suggestion';
                div.innerHTML = `
                    <i class="fas fa-lightbulb mr-2"></i>
                    ${suggestion}
                `;
                aiInsights.appendChild(div);
            });
        }

        // Performance monitoring
        function startPerformanceMonitoring() {
            let frameCount = 0;
            let lastTime = performance.now();

            function updatePerformance() {
                frameCount++;
                const currentTime = performance.now();
                
                if (currentTime - lastTime >= 1000) {
                    performanceMetrics.fps = frameCount;
                    performanceMetrics.memory = (performance.memory?.usedJSHeapSize / 1024 / 1024) || 0;
                    
                    document.getElementById('fps-counter').textContent = `${performanceMetrics.fps} FPS`;
                    document.getElementById('memory-usage').textContent = `${performanceMetrics.memory.toFixed(1)} MB`;
                    
                    // Update performance indicators
                    const renderPerf = document.getElementById('render-performance');
                    const memoryPerf = document.getElementById('memory-performance');
                    
                    renderPerf.textContent = performanceMetrics.fps >= 55 ? 'Excelente' : 
                                           performanceMetrics.fps >= 30 ? 'Boa' : 'Baixa';
                    renderPerf.className = performanceMetrics.fps >= 55 ? 'text-green-600' : 
                                          performanceMetrics.fps >= 30 ? 'text-yellow-600' : 'text-red-600';
                    
                    memoryPerf.textContent = performanceMetrics.memory < 50 ? 'Otimizada' : 
                                            performanceMetrics.memory < 100 ? 'Moderada' : 'Alta';
                    memoryPerf.className = performanceMetrics.memory < 50 ? 'text-green-600' : 
                                          performanceMetrics.memory < 100 ? 'text-yellow-600' : 'text-red-600';
                    
                    frameCount = 0;
                    lastTime = currentTime;
                }
                
                requestAnimationFrame(updatePerformance);
            }
            
            updatePerformance();
        }

        // Theme toggle
        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.body.setAttribute('data-theme', newTheme);
            appData.theme = newTheme;
            
            const themeIcon = document.querySelector('#theme-toggle i');
            themeIcon.className = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            
            saveAppData();
            showToast(`Tema ${newTheme === 'light' ? 'claro' : 'escuro'} ativado`, "info");
        }

        // Offline mode
        function enableOfflineMode() {
            appData.offlineMode = true;
            document.getElementById('offline-indicator').style.display = 'block';
            showToast("Modo offline habilitado", "success");
            
            // Simular cache de dados
            localStorage.setItem('hydraulicKitOptimizerCache', JSON.stringify({
                pecas: pecasDisponiveis,
                templates: [],
                timestamp: Date.now()
            }));
        }

        // Push notifications
        function showPushNotification(title, message) {
            const notification = document.getElementById('push-notification');
            notification.querySelector('.font-bold').textContent = title;
            notification.querySelector('.text-gray-600').textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Toast notifications supremas
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-1000 transform translate-x-full transition-transform duration-300`;
            
            const colors = {
                info: 'bg-blue-500 text-white',
                success: 'bg-green-500 text-white',
                warning: 'bg-yellow-500 text-white',
                error: 'bg-red-500 text-white'
            };
            
            const icons = {
                info: 'fas fa-info-circle',
                success: 'fas fa-check-circle',
                warning: 'fas fa-exclamation-triangle',
                error: 'fas fa-times-circle'
            };
            
            toast.className += ` ${colors[type]}`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="${icons[type]} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
            }, 100);
            
            // Animate out
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, duration);
        }

        // Renderização otimizada
        function renderPecasDisponiveis(pecas = pecasDisponiveis) {
            const pecasList = document.getElementById('pecas-list');
            pecasList.innerHTML = "";
            
            // Use DocumentFragment for better performance
            const fragment = document.createDocumentFragment();
            
            pecas.forEach(peca => {
                const pecaDiv = document.createElement("div");
                pecaDiv.className = "piece-item bg-gray-50 p-3 rounded-md shadow-sm text-center text-gray-700 text-sm cursor-pointer hover:bg-gray-100 transition-colors micro-interaction gpu-accelerated";
                
                const aiIndicator = peca.aiScore >= 90 ? '<i class="fas fa-star text-yellow-500"></i>' : '';
                const ecoIndicator = peca.ecoFriendly ? '<i class="fas fa-leaf text-green-500"></i>' : '';
                
                pecaDiv.innerHTML = `
                    <div class="font-semibold flex items-center justify-center">
                        ${peca.tipo} ${aiIndicator} ${ecoIndicator}
                    </div>
                    <div class="text-xs text-gray-500 mt-1">R$ ${peca.preco.toFixed(2)}</div>
                    <div class="text-xs text-gray-400">${peca.fornecedor} - ${peca.codigo}</div>
                    <div class="text-xs text-blue-500">IA Score: ${peca.aiScore}%</div>
                `;
                pecaDiv.dataset.pecaId = peca.id;
                
                // Add event listeners
                pecaDiv.addEventListener("click", () => {
                    addPecaToCanvas(peca.id, 100, 100);
                    showToast(`${peca.tipo} adicionada ao canvas`, "success");
                });
                
                fragment.appendChild(pecaDiv);
            });
            
            pecasList.appendChild(fragment);
        }

        // Funções de utilidade
        function generateUniqueId() {
            return `item-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        }

        function saveAppData() {
            localStorage.setItem("hydraulicKitOptimizerDataAI", JSON.stringify(appData));
        }

        function loadAppData() {
            const data = localStorage.getItem("hydraulicKitOptimizerDataAI");
            if (data) {
                const loadedData = JSON.parse(data);
                appData = { ...appData, ...loadedData };
            }
            
            // Ensure we have at least one project
            if (appData.obras.length === 0) {
                const newObra = {
                    id: `obra-${generateUniqueId()}`,
                    nome: "Projeto IA Supremo",
                    pecas: []
                };
                appData.obras.push(newObra);
                appData.currentObraId = newObra.id;
            }
        }

        function addPecaToCanvas(pecaId, x, y) {
            const pecaData = pecasDisponiveis.find(p => p.id === pecaId);
            const currentObra = appData.obras.find(obra => obra.id === appData.currentObraId);
            
            if (pecaData && currentObra) {
                const novaPeca = {
                    id: generateUniqueId(),
                    tipo: pecaData.tipo,
                    x: x,
                    y: y,
                    width: pecaData.width,
                    height: pecaData.height,
                    rotation: 0,
                    conferido: false,
                    svg: pecaData.svg,
                    aiScore: pecaData.aiScore
                };
                
                currentObra.pecas.push(novaPeca);
                saveAppData();
                renderCanvasPecas();
                updateProjectSummary();
            }
        }

        function renderCanvasPecas() {
            const canvas = document.getElementById('canvas');
            canvas.innerHTML = "";
            
            const currentObra = appData.obras.find(obra => obra.id === appData.currentObraId);
            if (!currentObra) return;

            currentObra.pecas.forEach(peca => {
                const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                g.setAttribute("transform", `translate(${peca.x}, ${peca.y})`);
                g.classList.add("draggable", "gpu-accelerated");
                g.dataset.pecaId = peca.id;
                g.innerHTML = peca.svg;
                
                // AI Score indicator
                if (peca.aiScore >= 90) {
                    const star = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    star.setAttribute("x", peca.width - 10);
                    star.setAttribute("y", 15);
                    star.setAttribute("fill", "#fbbf24");
                    star.setAttribute("font-size", "12");
                    star.textContent = "★";
                    g.appendChild(star);
                }
                
                canvas.appendChild(g);
            });
        }

        function updateProjectSummary() {
            const currentObra = appData.obras.find(obra => obra.id === appData.currentObraId);
            if (!currentObra) return;

            const totalPieces = currentObra.pecas.length;
            const checkedPieces = currentObra.pecas.filter(p => p.conferido).length;
            const progressPercentage = totalPieces > 0 ? Math.round((checkedPieces / totalPieces) * 100) : 0;
            
            let totalCost = 0;
            currentObra.pecas.forEach(peca => {
                const pecaData = pecasDisponiveis.find(p => p.tipo === peca.tipo);
                if (pecaData) totalCost += pecaData.preco;
            });

            document.getElementById("total-pieces").textContent = totalPieces;
            document.getElementById("checked-pieces").textContent = checkedPieces;
            document.getElementById("progress-percentage").textContent = `${progressPercentage}%`;
            document.getElementById("estimated-cost").textContent = `R$ ${totalCost.toFixed(2)}`;
            
            updateAIScore();
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            initAI();
            startPerformanceMonitoring();
            renderPecasDisponiveis();
            renderCanvasPecas();
            updateProjectSummary();
            
            // Set theme
            document.body.setAttribute('data-theme', appData.theme);
            const themeIcon = document.querySelector('#theme-toggle i');
            themeIcon.className = appData.theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            
            // Theme toggle
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            
            // AI buttons
            document.getElementById('ai-optimize-btn').addEventListener('click', optimizeWithAI);
            document.getElementById('ai-analyze-btn').addEventListener('click', optimizeWithAI);
            document.getElementById('enable-offline-btn').addEventListener('click', enableOfflineMode);
            
            // Show welcome notification
            setTimeout(() => {
                showPushNotification("IA Ativada", "Sistema de otimização inteligente pronto!");
            }, 2000);
            
            // Auto backup every 30 seconds
            setInterval(() => {
                if (appData.backupEnabled) {
                    appData.lastBackup = new Date().toISOString();
                    saveAppData();
                    document.getElementById('last-backup').textContent = 'Agora';
                }
            }, 30000);
        });

        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge30pOw==');
        }
    </script>
</body>
</html>
